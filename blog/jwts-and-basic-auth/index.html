<!doctype html><html lang=en><head><meta charset=utf-8><title>JWTs, a supplement to BasicAuth - sainth.de</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href="/favicon/apple-touch-icon.png?v=1"><link rel=icon type=image/png sizes=32x32 href="/favicon/favicon-32x32.png?v=1"><link rel=icon type=image/png sizes=16x16 href="/favicon/favicon-16x16.png?v=1"><link rel=manifest href="/favicon/site.webmanifest?v=1"><link rel=mask-icon href="/favicon/safari-pinned-tab.svg?v=1" color=#ffffff><link rel="shortcut icon" href="/favicon/favicon.ico?v=1"><meta name=msapplication-config content="/favicon/browserconfig.xml?v=1"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><meta name=generator content="Hugo 0.79.0"><meta property="og:site_name" content="sainth.de"><meta property="og:title" content="JWTs, a supplement to BasicAuth"><meta property="og:description" content="How to use JWTs with BasicAuth."><meta property="description" content="How to use JWTs with BasicAuth."><meta property="og:url" content="https://www.sainth.de/blog/jwts-and-basic-auth/"><meta property="og:type" content="article"><meta property="og:image" content="https://www.sainth.de/img/2017/05/jwt-logo.svg"><meta property="og:image:alt" content="JWT logo"><link rel=stylesheet href=/css/bundle.min.d9e04ae08c9b3049b766dbd4aeab7d862c5ea1d13679b621490e0f5df5507497.css integrity="sha256-2eBK4IybMEm3ZtvUrqt9hixeodE2ebYhSQ4PXfVQdJc="><link rel=stylesheet href=/css/add-on.css></head><body><header id=site-header><nav id=site-nav><h1 class=nav-title><a href=/ class=nav>Blog</a></h1><menu id=site-nav-menu class="flyout-menu menu"><a href=/ class="nav link"><i class="fa fa-home"></i>Home</a>
<a href=/about/ class="nav link"><i class="far fa-id-card"></i>About me</a>
<a href=/blog/ class="nav link"><i class="far fa-newspaper"></i>Blog</a>
<a href=/projects/ class="nav link"><i class="far fa-microchip"></i>Projects</a>
<a href=/publications/ class="nav link"><i class="far fa-angle-double-right"></i>Publications</a>
<a href=/categories/ class="nav link"><i class="fas fa-sitemap"></i>Categories</a>
<a href=/contact/ class="nav link"><i class="far fa-envelope"></i>Contact</a>
<a href=#share-menu class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
<a href=#search-input class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a></menu>
<a href=#search-input class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
<a href=#share-menu class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
<a href=#lang-menu class="nav lang-toggle" lang=en>en</a>
<a href=#site-nav class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a></nav><menu id=search class=menu><input id=search-input class="search-input menu"></input><div id=search-results class="search-results menu"></div></menu><menu id=lang-menu class="flyout-menu menu"><a href=# lang=en class="nav link active">English (en)</a>
<a href=https://www.sainth.de/de/blog/jwts-and-basic-auth/ lang=de class="nav link">Deutsch (de)</a></menu>
<menu id=share-menu class="flyout-menu menu"><h1>Share Post</h1><a href="//twitter.com/share?text=JWTs%2c%20a%20supplement%20to%20BasicAuth&url=https%3a%2f%2fwww.sainth.de%2fblog%2fjwts-and-basic-auth%2f" target=_blank rel=noopener class="nav share-btn twitter"><p>Twitter</p></a><a href="//www.reddit.com/submit?url=https%3a%2f%2fwww.sainth.de%2fblog%2fjwts-and-basic-auth%2f&title=JWTs%2c%20a%20supplement%20to%20BasicAuth" target=_blank rel=noopener class="nav share-btn reddit"><p>Reddit</p></a><a href="mailto:?subject=Check%20out%20this%20post%20by Tobias%20Wink&body=https%3a%2f%2fwww.sainth.de%2fblog%2fjwts-and-basic-auth%2f" target=_blank class="nav share-btn email" data-proofer-ignore><p>Email</p></a></menu></header><div id=wrapper><section id=site-intro class=hidden-single-column><a href=/><img src=https://www.sainth.de/img/main/logo.png class=circle width=100 alt=sainth.de></a><header><h1>sainth.de</h1></header><main><p>A personal blog about everything that interests me, so mostly programming in general and game programming in particular.</p></main><footer><ul class=socnet-icons><li><a href=//github.com/sainthDE target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//xing.com/profile/Tobias_Wink2 target=_blank rel=noopener title=Xing class="fab fa-xing"></a></li><li><a href=mailto:info@sainth.de target=_blank title=Email class="far fa-envelope"></a></li></ul></footer></section><main id=site-main><article class=post><header><div class=title><h2><a href=/blog/jwts-and-basic-auth/>JWTs, a supplement to BasicAuth</a></h2><p>How to use JWTs with BasicAuth.</p></div><div class=meta><time datetime="2017-05-01 19:30:00 +0100 +0100">May 1, 2017</time><p>Tobias Wink</p><p>5-Minute Read</p></div></header><div id=socnet-share><a href="//twitter.com/share?text=JWTs%2c%20a%20supplement%20to%20BasicAuth&url=https%3a%2f%2fwww.sainth.de%2fblog%2fjwts-and-basic-auth%2f" target=_blank rel=noopener class="nav share-btn twitter"><p>Twitter</p></a><a href="//www.reddit.com/submit?url=https%3a%2f%2fwww.sainth.de%2fblog%2fjwts-and-basic-auth%2f&title=JWTs%2c%20a%20supplement%20to%20BasicAuth" target=_blank rel=noopener class="nav share-btn reddit"><p>Reddit</p></a><a href="mailto:?subject=Check%20out%20this%20post%20by Tobias%20Wink&body=https%3a%2f%2fwww.sainth.de%2fblog%2fjwts-and-basic-auth%2f" target=_blank class="nav share-btn email" data-proofer-ignore><p>Email</p></a></div><div class=content><a href=/blog/jwts-and-basic-auth/ class=image style="--bg-image: url('https://www.sainth.de/img/2017/05/jwt-logo.svg')"><img class=stretchV src=https://www.sainth.de/img/2017/05/jwt-logo.svg alt="JWT logo"></a><p>Most REST APIs support BasicAuth when they require authentication and manage user data themselves. When choosing the function to protect stored passwords, it is important to find the right balance between user convenience and attacker protection. On the one hand, you want to keep adversaries at bay for as long as possible, but on the other hand, you also want to give users the shortest possible response times. All adaptive password hashing methods recommended by <a href=https://www.owasp.org/index.php/Password_Storage_Cheat_Sheet#Impose_infeasible_verification_on_attacker>OWASP</a> therefore offer the option of configuring the speed of the algorithm via a <em>work factor</em>. In order to be able to select this <em>work factor</em> as high as possible, without annoying the users unnecessarily, the use of JWTs lends itself.</p><h3 id=what-is-a-jwt>What is a JWT?</h3><p>A JSON Web Token, or JWT (pronounced &ldquo;jot&rdquo;), is a simple and compact format for transferring <abbr title="Claims are statements or assignments about a particular party or object. A subset of claims and their associated meanings are part of the JWT specification.">Claims</abbr>. JWTs are designed to be used in areas that are sensitive to whitespace, such as HTTP Authorization headers. A JWT is really just a <a href=https://tools.ietf.org/html/rfc7159>JSON object</a> that contains the <abbr title="Claims are statements or assignments about a particular party or object. A subset of claims and their associated meanings are part of the JWT specification.">Claims</abbr> as content. In the related <a href=https://tools.ietf.org/html/rfc7519>RFC 7519</a>, some <abbr title="Claims are statements or assignments about a particular party or object. A subset of claims and their associated meanings are part of the JWT specification.">Claims</abbr> are predefined, in my opinion the most important ones:</p><ul><li><em>sub</em>-Claim (Subject): Contains the principal for the JWT.</li><li><em>exp</em>-Claim (Expiration Date): Defines the expiration date for the JWT. After this timestamp has expired, the JWT may no longer be accepted or processed.</li><li><em>jti</em>-Claim (JWT ID): Represents a unique ID for the JWT. With the help of this claim it should be possible to distinguish JWTs despite similar other content and thus prevent replay attacks.</li></ul><p>If the predefined <abbr title="Claims are statements or assignments about a particular party or object. A subset of claims and their associated meanings are part of the JWT specification.">Claims</abbr> are not sufficient, you may add private <abbr title="Claims are statements or assignments about a particular party or object. A subset of claims and their associated meanings are part of the JWT specification.">Claims</abbr> to them as long as there are no conflicts with the public <abbr title="Claims are statements or assignments about a particular party or object. A subset of claims and their associated meanings are part of the JWT specification.">Claims</abbr>.</p><h3 id=how-to-use-them>How to use them?</h3><p>JWTs are used as payload for JWS elements or also as plaintext within JWE elements, but I will limit myself to JWS elements here. A JWS element consists of the three sections header, payload and signature, each separated by a dot &ldquo;.&rdquo;. The following is an example of a fully encoded JWT - for better readability the sections have been moved to separate lines:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span>.
<span style=color:#a6e22e>eyJzdWIiOiIxMjM0NTY3ODkwIiwicm9sZSI6ImFkbWluIn0</span>.
<span style=color:#a6e22e>OC16ViAXu0_JaKXlUKQVHCKeZn1tXTwcwMDRpmY6xyc</span>
</code></pre></div><p>Header and payload are &lt;abbr title=&ldquo;Modified version of Base64 where &ldquo;+&rdquo; and &ldquo;/&rdquo; are replaced by &ldquo;-&rdquo; and &ldquo;<em>&rdquo; respectively.">Base64 URL</abbr> encoded JSON objects. The signature is created over the header and payload values concatenated with &ldquo;.&rdquo; and already encoded, and is also &lt;abbr title=&ldquo;Modified version of Base64 where &ldquo;+&rdquo; and &ldquo;/&rdquo; are replaced by &ldquo;-&rdquo; and &ldquo;</em>&rdquo; respectively.">Base64 URL</abbr> encoded. The algorithm used for the signature is specified in the header claim <em>alg</em>. A possible pseudocode example of signature creation for the previous example would be:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#a6e22e>base64UrlEncode</span>(
  <span style=color:#a6e22e>HMACSHA256</span>(
    <span style=color:#a6e22e>base64UrlEncode</span>(<span style=color:#a6e22e>header</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>base64UrlEncode</span>(<span style=color:#a6e22e>payload</span>),
    <span style=color:#e6db74>&#34;secret&#34;</span>
  )
)
</code></pre></div><p>According to <a href=https://tools.ietf.org/html/rfc7515>RFC 7515</a>, JWS implementations must support only one algorithm for signing: <abbr title="Keyed-Hash Message Authentication Code">HMAC</abbr> with SHA-256, also called HS256. But it is recommended to support RS256 (<abbr title="Variation of RSA Algorithm for Digital Signatures">RSASSA</abbr> PKCS1 v1.5 with SHA-256) and ES256 (<abbr title="Elliptic Curve Digital Signature Algorithm">ECDSA</abbr> with P-256 and SHA-256) as well. Many libraries also support corresponding variations of the three algorithms with SHA-384 or SHA-512 instead of SHA-256.</p><p>All signature methods serve the same purpose: they allow to ensure the authenticity of the JWT <abbr title="Claims are statements or assignments about a particular party or object. A subset of claims and their associated meanings are part of the JWT specification.">claims</abbr>. All <abbr title="Keyed-Hash Message Authentication Code">HMAC</abbr> procedures use a shared secret for generation/validation, for this reason the trust between parties using JWS with <abbr title="Keyed-Hash Message Authentication Code">HMAC</abbr> procedures must be very high. If the trust between the parties is not so high (e.g. different operators), a procedure based on <abbr title="Variation of RSA Algorithm for Digital Signatures">RSASSA</abbr> or <abbr title="Elliptic Curve Digital Signature Algorithm">ECDSA</abbr> should definitely be used, since both procedures are public-key algorithms. Thus, the JWT is signed by the issuer with the private key when it is generated and anyone who has the associated public key can subsequently validate the signature.</p><h3 id=how-to-use-jws-in-conjunction-with-basicauth>How to use JWS in conjunction with BasicAuth?</h3><p>BasicAuth should only be used for the first request. In each response a new token should be sent or stored in the cookie, ideally with a new value for <em>jti</em> claim (which of course should also be evaluated on the server side). The way over the cookie is to be preferred in my opinion, if it is possible, because you don&rsquo;t have to think about reading the token on the frontend side to send it again with the next request. Furthermore it increases the security if the cookie has the <em>HttpOnly</em> flag, because you can&rsquo;t access it via JavaScript now. If you still need to send the token with every request, it has become established to send it as a <em>Bearer</em> token, e.g. <code>Authorization : Bearer &lt;JWS></code>.</p><p>Since the password only has to be sent with the first request and thus has to be checked, the password hash method used can now be set so that it requires at least 200ms for hashing. This also increases the password security.</p><p>As a further extra, it is now possible to determine whether a client has access in the reverse proxy or load balancer by checking the token there. For this there are free modules or has NGINX Plus from R10 <a href=https://nginx.org/en/docs/http/ngx_http_auth_jwt_module.html>native support</a> for JWTs. On the one hand, this relieves the backend and on the other hand, components that know nothing about authentication, e.g. a <abbr title="Content Delivery Network">CDN</abbr>, can also be protected.</p><h3 id=what-should-you-pay-attention-to>What should you pay attention to?</h3><ul><li>These tokens should only be used for authentication and should not be abused as session cookies.</li><li>JWT claims as payload of JWS elements are readable for everyone, thus only such information should be stored/transferred there that may also be visible for everyone.</li><li>JWS elements without a signature should be considered invalid.</li><li>The <em>exp</em> claim should always be used to restrict the validity of a token.</li><li>The <em>jti</em> claim should always be used to prevent replay attacks.</li><li>When using JWTs to authenticate REST APIs, the JWT should be stored in a cookie with <em>HttpOnly</em> set.</li><li>If frontend and REST backend are accessible through the same domain, the cookie should use <a href=https://www.owasp.org/index.php/SameSite>SameSite</a>, even if it is supported only by Chromium/ Chrome and Opera so far.</li></ul><h3 id=weiterführende-links>Weiterführende Links</h3><ul><li><a href=https://tools.ietf.org/html/rfc7515>RFC 7515</a>: JSON Web Signature (JWS)</li><li><a href=https://tools.ietf.org/html/rfc7516>RFC 7516</a>: JSON Web Encryption (JWE)</li><li><a href=https://tools.ietf.org/html/rfc7517>RFC 7517</a>: JSON Web Key (JWK)</li><li><a href=https://tools.ietf.org/html/rfc7518>RFC 7518</a>: JSON Web Algorithms (JWA)</li><li><a href=https://tools.ietf.org/html/rfc7519>RFC 7519</a>: JSON Web Token (JWT)</li><li><a href=https://tools.ietf.org/html/rfc7520>RFC 7520</a>: Examples of Protecting Content Using JSON Object Signing and Encryption (JOSE)</li><li><a href=https://jwt.io/>jwt.io</a>: Website about JWTs by <a href=https://auth0.com/>auth0</a> with a free, detailed manual about JWTs.</li></ul></div><footer><div class=stats><ul class=categories><li><a class=article-terms-link href=/categories/programming/>programming</a></li><li><a class=article-terms-link href=/categories/tutorials/>tutorials</a></li></ul><ul class=tags><li><a class=article-terms-link href=/tags/web/>web</a></li><li><a class=article-terms-link href=/tags/security/>security</a></li></ul></div></footer></article><div class=pagination><a href=/blog/use-nexus-as-a-binary-repository-for-apks/ class="button right"><span>Nexus as a binary repository for APKs</span></a></div></main><section id=site-sidebar><section id=recent-posts><header><h1>Recent Posts</h1></header><article class=mini-post><a href=/blog/jwts-and-basic-auth/ class=image style="--bg-image: url('https://www.sainth.de/img/2017/05/jwt-logo.svg')"><img class=stretchV src=https://www.sainth.de/img/2017/05/jwt-logo.svg alt="JWT logo"></a><header><h2><a href=/blog/jwts-and-basic-auth/>JWTs, a supplement to BasicAuth</a></h2><time class=published datetime="2017-05-01 19:30:00 +0100 +0100">May 1, 2017</time></header></article><article class=mini-post><a href=/blog/use-nexus-as-a-binary-repository-for-apks/ class=image style="--bg-image: url('https://www.sainth.de/img/2017/01/nexus.png')"><img class=stretchV src=https://www.sainth.de/img/2017/01/nexus.png alt="Nexus logo"></a><header><h2><a href=/blog/use-nexus-as-a-binary-repository-for-apks/>Nexus as a binary repository for APKs</a></h2><time class=published datetime="2017-01-17 21:30:00 +0100 +0100">January 17, 2017</time></header></article><article class=mini-post><a href=/blog/asciidoctor-pdf/ class=image style="--bg-image: url('https://www.sainth.de/img/2016/05/asciidoctor.png')"><img class=stretchV src=https://www.sainth.de/img/2016/05/asciidoctor.png alt="Asciidoctor logo"></a><header><h2><a href=/blog/asciidoctor-pdf/>Asciidoctor PDF</a></h2><time class=published datetime="2016-05-27 14:15:00 +0100 +0100">May 27, 2016</time></header></article><footer><a href=/blog/ class=button>See More</a></footer></section><section id=categories><header><h1><a href=/categories>Categories</a></h1></header><ul><li><a href=/categories/devops/>devops<span class=count>2</span></a><li><a href=/categories/fp/>fp<span class=count>2</span></a><li><a href=/categories/misc/>misc<span class=count>2</span></a><li><a href=/categories/tutorials/>tutorials<span class=count>2</span></a><li><a href=/categories/books/>books<span class=count>1</span></a><li><a href=/categories/programming/>programming<span class=count>1</span></a></li></ul></section><section id=mini-bio><header><h1>About</h1></header><p>I'm just a simple person who is somewhat involved with computers. 😉</p><footer><a href=/about class=button>Learn More</a></footer></section></section></div><footer id=site-footer><ul class=socnet-icons><li><a href=//github.com/sainthDE target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//xing.com/profile/Tobias_Wink2 target=_blank rel=noopener title=Xing class="fab fa-xing"></a></li><li><a href=mailto:info@sainth.de target=_blank title=Email class="far fa-envelope"></a></li></ul><p class=copyright><a href=https://www.sainth.de/privacy_policy/>Privacy Policy</a> &mdash;
©2015-2020 Tobias Wink <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a><br>Theme: <a href=https://github.com/pacollins/hugo-future-imperfect-slim target=_blank rel=noopener>Hugo Future Imperfect Slim</a> &mdash; A <a href=https://html5up.net/future-imperfect target=_blank rel=noopener>HTML5 UP port</a> | Powered by <a href=https://gohugo.io/ title=0.79.0 target=_blank rel=noopener>Hugo</a></p></footer><a id=back-to-top href=# class="fas fa-arrow-up fa-2x"></a><script src=/js/highlight.js></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/bundle.min.b4e669fa428a81defb8af0916c53f39cd1b8e0bbab22199c06f0b182907ba474.js integrity="sha256-tOZp+kKKgd77ivCRbFPznNG44LurIhmcBvCxgpB7pHQ="></script><script src=/js/add-on.js></script></body></html>