<!doctype html><html lang=en><head><meta charset=utf-8><title>Nexus as a binary repository for APKs - sainth.de</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href="/favicon/apple-touch-icon.png?v=1"><link rel=icon type=image/png sizes=32x32 href="/favicon/favicon-32x32.png?v=1"><link rel=icon type=image/png sizes=16x16 href="/favicon/favicon-16x16.png?v=1"><link rel=manifest href="/favicon/site.webmanifest?v=1"><link rel=mask-icon href="/favicon/safari-pinned-tab.svg?v=1" color=#ffffff><link rel="shortcut icon" href="/favicon/favicon.ico?v=1"><meta name=msapplication-config content="/favicon/browserconfig.xml?v=1"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><meta name=generator content="Hugo 0.79.0"><meta property="og:site_name" content="sainth.de"><meta property="og:title" content="Nexus as a binary repository for APKs"><meta property="og:description" content="Brief tutorial, to show how to use Nexus OSS as a binary repository for APKs"><meta property="description" content="Brief tutorial, to show how to use Nexus OSS as a binary repository for APKs"><meta property="og:url" content="https://www.sainth.de/blog/use-nexus-as-a-binary-repository-for-apks/"><meta property="og:type" content="article"><meta property="og:image" content="https://www.sainth.de/img/2017/01/nexus.png"><meta property="og:image:alt" content="Nexus logo"><link rel=stylesheet href=/css/bundle.min.d9e04ae08c9b3049b766dbd4aeab7d862c5ea1d13679b621490e0f5df5507497.css integrity="sha256-2eBK4IybMEm3ZtvUrqt9hixeodE2ebYhSQ4PXfVQdJc="><link rel=stylesheet href=/css/add-on.css></head><body><header id=site-header><nav id=site-nav><h1 class=nav-title><a href=/ class=nav>Blog</a></h1><menu id=site-nav-menu class="flyout-menu menu"><a href=/ class="nav link"><i class="fa fa-home"></i>Home</a>
<a href=/about/ class="nav link"><i class="far fa-id-card"></i>About me</a>
<a href=/blog/ class="nav link"><i class="far fa-newspaper"></i>Blog</a>
<a href=/projects/ class="nav link"><i class="far fa-microchip"></i>Projects</a>
<a href=/publications/ class="nav link"><i class="far fa-angle-double-right"></i>Publications</a>
<a href=/categories/ class="nav link"><i class="fas fa-sitemap"></i>Categories</a>
<a href=/contact/ class="nav link"><i class="far fa-envelope"></i>Contact</a>
<a href=#share-menu class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
<a href=#search-input class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a></menu>
<a href=#search-input class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
<a href=#share-menu class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
<a href=#lang-menu class="nav lang-toggle" lang=en>en</a>
<a href=#site-nav class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a></nav><menu id=search class=menu><input id=search-input class="search-input menu"></input><div id=search-results class="search-results menu"></div></menu><menu id=lang-menu class="flyout-menu menu"><a href=# lang=en class="nav link active">English (en)</a>
<a href=https://www.sainth.de/de/blog/use-nexus-as-a-binary-repository-for-apks/ lang=de class="nav link">Deutsch (de)</a></menu>
<menu id=share-menu class="flyout-menu menu"><h1>Share Post</h1><a href="//twitter.com/share?text=Nexus%20as%20a%20binary%20repository%20for%20APKs&url=https%3a%2f%2fwww.sainth.de%2fblog%2fuse-nexus-as-a-binary-repository-for-apks%2f" target=_blank rel=noopener class="nav share-btn twitter"><p>Twitter</p></a><a href="//www.reddit.com/submit?url=https%3a%2f%2fwww.sainth.de%2fblog%2fuse-nexus-as-a-binary-repository-for-apks%2f&title=Nexus%20as%20a%20binary%20repository%20for%20APKs" target=_blank rel=noopener class="nav share-btn reddit"><p>Reddit</p></a><a href="mailto:?subject=Check%20out%20this%20post%20by Tobias%20Wink&body=https%3a%2f%2fwww.sainth.de%2fblog%2fuse-nexus-as-a-binary-repository-for-apks%2f" target=_blank class="nav share-btn email" data-proofer-ignore><p>Email</p></a></menu></header><div id=wrapper><section id=site-intro class=hidden-single-column><a href=/><img src=https://www.sainth.de/img/main/logo.png class=circle width=100 alt=sainth.de></a><header><h1>sainth.de</h1></header><main><p>A personal blog about everything that interests me, so mostly programming in general and game programming in particular.</p></main><footer><ul class=socnet-icons><li><a href=//github.com/sainthDE target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//xing.com/profile/Tobias_Wink2 target=_blank rel=noopener title=Xing class="fab fa-xing"></a></li><li><a href=mailto:info@sainth.de target=_blank title=Email class="far fa-envelope"></a></li></ul></footer></section><main id=site-main><article class=post><header><div class=title><h2><a href=/blog/use-nexus-as-a-binary-repository-for-apks/>Nexus as a binary repository for APKs</a></h2><p>Brief tutorial, to show how to use Nexus OSS as a binary repository for APKs</p></div><div class=meta><time datetime="2017-01-17 21:30:00 +0100 +0100">January 17, 2017</time><p>Tobias Wink</p><p>3-Minute Read</p></div></header><div id=socnet-share><a href="//twitter.com/share?text=Nexus%20as%20a%20binary%20repository%20for%20APKs&url=https%3a%2f%2fwww.sainth.de%2fblog%2fuse-nexus-as-a-binary-repository-for-apks%2f" target=_blank rel=noopener class="nav share-btn twitter"><p>Twitter</p></a><a href="//www.reddit.com/submit?url=https%3a%2f%2fwww.sainth.de%2fblog%2fuse-nexus-as-a-binary-repository-for-apks%2f&title=Nexus%20as%20a%20binary%20repository%20for%20APKs" target=_blank rel=noopener class="nav share-btn reddit"><p>Reddit</p></a><a href="mailto:?subject=Check%20out%20this%20post%20by Tobias%20Wink&body=https%3a%2f%2fwww.sainth.de%2fblog%2fuse-nexus-as-a-binary-repository-for-apks%2f" target=_blank class="nav share-btn email" data-proofer-ignore><p>Email</p></a></div><div class=content><a href=/blog/use-nexus-as-a-binary-repository-for-apks/ class=image style="--bg-image: url('https://www.sainth.de/img/2017/01/nexus.png')"><img class=stretchV src=https://www.sainth.de/img/2017/01/nexus.png alt="Nexus logo"></a><p>If you use <a href=https://www.sonatype.com/download-oss-sonatype>Nexus OSS</a> to store your finished binary artifacts, you will of course want to do the same for your APKs. Since I&rsquo;m currently working on an Android app professionally, I&rsquo;ve now had the chance to gain my experience with it. Because I don&rsquo;t want to make the same pitfalls again next time, I will explain it here step by step.</p><p>My previous experiences with <a href=https://gradle.org/>Gradle</a> are (fortunately) hardly worth mentioning, so first an extensive Google research was on the agenda. This soon led me to the <a href=https://docs.gradle.org/current/userguide/maven_plugin.html>Maven plugin</a> for Gradle and the following configuration for <code>uploadArchives</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>apply plugin: <span style=color:#e6db74>&#39;maven&#39;</span>

uploadArchives <span style=color:#f92672>{</span>
  repositories <span style=color:#f92672>{</span>
    mavenDeployer <span style=color:#f92672>{</span>
      repository<span style=color:#f92672>(</span>url: <span style=color:#e6db74>&#34;file://localhost/tmp/myRepo/&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>A corresponding call with <code>gradlew clean assemble uploadArchives</code> ran successfully, but no artifacts were stored. So I then became aware of the Gradle user guide <a href=https://docs.gradle.org/current/userguide/artifact_management.html>Publishing artifacts</a> and realized that the APKs must be declared so that <code>uploadArchives</code> also knows what is to be uploaded.</p><p>To add the APKs of all <a href=https://developer.android.com/studio/build/build-variants.html>build variants</a> (debug, release and/ or <a href=https://developer.android.com/studio/build/build-variants.html#product-flavors>productflavors</a>) created with <code>assemble</code> the following addition helps:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>android<span style=color:#f92672>.</span><span style=color:#a6e22e>applicationVariants</span><span style=color:#f92672>.</span><span style=color:#a6e22e>all</span> <span style=color:#f92672>{</span> variant <span style=color:#f92672>-&gt;</span>
  <span style=color:#66d9ef>def</span> apkFile <span style=color:#f92672>=</span> file<span style=color:#f92672>(</span>variant<span style=color:#f92672>.</span><span style=color:#a6e22e>outputs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>outputFile</span><span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>])</span>

  tasks<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;assemble${variant.name.capitalize()}&#34;</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>{</span>
      archives file: apkFile
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Unfortunately, now with the added APKs <code>uploadArchives</code> does not work anymore, because within one POM there must not be multiple artifacts of the same type and classifier. The following error message appears:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:app:uploadArchives FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed <span style=color:#66d9ef>for</span> task <span style=color:#e6db74>&#39;:app:uploadArchives&#39;</span>.
&gt; Could not publish configuration <span style=color:#e6db74>&#39;archives&#39;</span>
   &gt; A POM cannot have multiple artifacts with the same type and classifier. Already have MavenArtifact app:apk:apk:null, trying to add MavenArtifact app:apk:apk:null.
</code></pre></div><p>So the configuration of the artifacts has to be extended a bit. The easiest way to do this is via the <code>classifier</code>, as in the following snippet:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>android<span style=color:#f92672>.</span><span style=color:#a6e22e>applicationVariants</span><span style=color:#f92672>.</span><span style=color:#a6e22e>all</span> <span style=color:#f92672>{</span> variant <span style=color:#f92672>-&gt;</span>
  <span style=color:#66d9ef>def</span> apkFile <span style=color:#f92672>=</span> file<span style=color:#f92672>(</span>variant<span style=color:#f92672>.</span><span style=color:#a6e22e>outputs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>outputFile</span><span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>])</span>

  tasks<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;assemble${variant.name.capitalize()}&#34;</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>{</span>
      archives file: apkFile<span style=color:#f92672>,</span> name: variant<span style=color:#f92672>.</span><span style=color:#a6e22e>baseName</span><span style=color:#f92672>,</span> type: <span style=color:#e6db74>&#39;apk&#39;</span><span style=color:#f92672>,</span> classifier: variant<span style=color:#f92672>.</span><span style=color:#a6e22e>baseName</span>
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>This completes the first part. The APKs end up in the configured repository. Now only the default values of the <a href=https://docs.gradle.org/current/userguide/maven_plugin.html#sec:maven_pom_generation>POM generation</a> have to be adjusted if needed, in my case <code>groupId</code>, <code>artifactId</code> and <code>version</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>apply plugin: <span style=color:#e6db74>&#39;maven&#39;</span>

uploadArchives <span style=color:#f92672>{</span>
  repositories <span style=color:#f92672>{</span>
    mavenDeployer <span style=color:#f92672>{</span>
      repository<span style=color:#f92672>(</span>url: <span style=color:#e6db74>&#34;file://localhost/tmp/myRepo/&#34;</span><span style=color:#f92672>)</span>
      pom <span style=color:#f92672>{</span>
        groupId <span style=color:#e6db74>&#39;de.sainth.android&#39;</span>
        artifactId <span style=color:#e6db74>&#39;meineTolleApp&#39;</span>
        version android<span style=color:#f92672>.</span><span style=color:#a6e22e>defaultConfig</span><span style=color:#f92672>.</span><span style=color:#a6e22e>versionName</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Last but not least, replace the local repository with the real one. To avoid having to check in the credentials for the Nexus, it is a good idea to store them in the central <code>~/.gradle/gradle.properties</code> and point to it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>nexusUser<span style=color:#f92672>=</span>Benutzername
nexusPassword<span style=color:#f92672>=</span>Passwort
</code></pre></div><p>This is how the following configuration for the interaction of Gradle and Nexus for APK storage is created in the end:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>apply plugin: <span style=color:#e6db74>&#39;maven&#39;</span>

android<span style=color:#f92672>.</span><span style=color:#a6e22e>applicationVariants</span><span style=color:#f92672>.</span><span style=color:#a6e22e>all</span> <span style=color:#f92672>{</span> variant <span style=color:#f92672>-&gt;</span>
  <span style=color:#66d9ef>def</span> apkFile <span style=color:#f92672>=</span> file<span style=color:#f92672>(</span>variant<span style=color:#f92672>.</span><span style=color:#a6e22e>outputs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>outputFile</span><span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>])</span>

  tasks<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;assemble${variant.name.capitalize()}&#34;</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>{</span>
      archives file: apkFile<span style=color:#f92672>,</span> name: variant<span style=color:#f92672>.</span><span style=color:#a6e22e>baseName</span><span style=color:#f92672>,</span> type: <span style=color:#e6db74>&#39;apk&#39;</span><span style=color:#f92672>,</span> classifier: variant<span style=color:#f92672>.</span><span style=color:#a6e22e>baseName</span>
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

uploadArchives <span style=color:#f92672>{</span>
  repositories <span style=color:#f92672>{</span>
    mavenDeployer <span style=color:#f92672>{</span>
      repository<span style=color:#f92672>(</span>url: <span style=color:#e6db74>&#34;https://mein.nexus.de/repo/&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        authentication<span style=color:#f92672>(</span>userName: <span style=color:#e6db74>&#34;$nexusUser&#34;</span><span style=color:#f92672>,</span> password: <span style=color:#e6db74>&#34;$nexusPassword&#34;</span><span style=color:#f92672>)</span>
      <span style=color:#f92672>}</span>
      pom <span style=color:#f92672>{</span>
        groupId <span style=color:#e6db74>&#39;de.sainth.android&#39;</span>
        artifactId <span style=color:#e6db74>&#39;meineTolleApp&#39;</span>
        version android<span style=color:#f92672>.</span><span style=color:#a6e22e>defaultConfig</span><span style=color:#f92672>.</span><span style=color:#a6e22e>versionName</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div><footer><div class=stats><ul class=categories><li><a class=article-terms-link href=/categories/devops/>devops</a></li><li><a class=article-terms-link href=/categories/tutorials/>tutorials</a></li></ul><ul class=tags><li><a class=article-terms-link href=/tags/android/>android</a></li><li><a class=article-terms-link href=/tags/gradle/>gradle</a></li></ul></div></footer></article><div class=pagination><a href=/blog/jwts-and-basic-auth/ class="button left"><span>JWTs, a supplement to BasicAuth</span></a>
<a href=/blog/asciidoctor-pdf/ class="button right"><span>Asciidoctor PDF</span></a></div></main><section id=site-sidebar><section id=recent-posts><header><h1>Recent Posts</h1></header><article class=mini-post><a href=/blog/jwts-and-basic-auth/ class=image style="--bg-image: url('https://www.sainth.de/img/2017/05/jwt-logo.svg')"><img class=stretchV src=https://www.sainth.de/img/2017/05/jwt-logo.svg alt="JWT logo"></a><header><h2><a href=/blog/jwts-and-basic-auth/>JWTs, a supplement to BasicAuth</a></h2><time class=published datetime="2017-05-01 19:30:00 +0100 +0100">May 1, 2017</time></header></article><article class=mini-post><a href=/blog/use-nexus-as-a-binary-repository-for-apks/ class=image style="--bg-image: url('https://www.sainth.de/img/2017/01/nexus.png')"><img class=stretchV src=https://www.sainth.de/img/2017/01/nexus.png alt="Nexus logo"></a><header><h2><a href=/blog/use-nexus-as-a-binary-repository-for-apks/>Nexus as a binary repository for APKs</a></h2><time class=published datetime="2017-01-17 21:30:00 +0100 +0100">January 17, 2017</time></header></article><article class=mini-post><a href=/blog/asciidoctor-pdf/ class=image style="--bg-image: url('https://www.sainth.de/img/2016/05/asciidoctor.png')"><img class=stretchV src=https://www.sainth.de/img/2016/05/asciidoctor.png alt="Asciidoctor logo"></a><header><h2><a href=/blog/asciidoctor-pdf/>Asciidoctor PDF</a></h2><time class=published datetime="2016-05-27 14:15:00 +0100 +0100">May 27, 2016</time></header></article><footer><a href=/blog/ class=button>See More</a></footer></section><section id=categories><header><h1><a href=/categories>Categories</a></h1></header><ul><li><a href=/categories/devops/>devops<span class=count>2</span></a><li><a href=/categories/fp/>fp<span class=count>2</span></a><li><a href=/categories/misc/>misc<span class=count>2</span></a><li><a href=/categories/tutorials/>tutorials<span class=count>2</span></a><li><a href=/categories/books/>books<span class=count>1</span></a><li><a href=/categories/programming/>programming<span class=count>1</span></a></li></ul></section><section id=mini-bio><header><h1>About</h1></header><p>I'm just a simple person who is somewhat involved with computers. 😉</p><footer><a href=/about class=button>Learn More</a></footer></section></section></div><footer id=site-footer><ul class=socnet-icons><li><a href=//github.com/sainthDE target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//xing.com/profile/Tobias_Wink2 target=_blank rel=noopener title=Xing class="fab fa-xing"></a></li><li><a href=mailto:info@sainth.de target=_blank title=Email class="far fa-envelope"></a></li></ul><p class=copyright><a href=https://www.sainth.de/privacy_policy/>Privacy Policy</a> &mdash;
©2015-2020 Tobias Wink <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a><br>Theme: <a href=https://github.com/pacollins/hugo-future-imperfect-slim target=_blank rel=noopener>Hugo Future Imperfect Slim</a> &mdash; A <a href=https://html5up.net/future-imperfect target=_blank rel=noopener>HTML5 UP port</a> | Powered by <a href=https://gohugo.io/ title=0.79.0 target=_blank rel=noopener>Hugo</a></p></footer><a id=back-to-top href=# class="fas fa-arrow-up fa-2x"></a><script src=/js/highlight.js></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/bundle.min.b4e669fa428a81defb8af0916c53f39cd1b8e0bbab22199c06f0b182907ba474.js integrity="sha256-tOZp+kKKgd77ivCRbFPznNG44LurIhmcBvCxgpB7pHQ="></script><script src=/js/add-on.js></script></body></html>